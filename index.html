<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>

		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">

		<style type="text/css">
			html, body, #map-canvas {
				height: 100%;
				margin: 10px;
				padding: 10px
			}

			.showorhide {
				display: none;
			}
		</style>

		<script type='text/javascript' src='https://www.google.com/jsapi'></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
		<script type="text/javascript" src="http://www.santarosa.edu/~jperetz/projects/lib/prettify/prettify.js"></script>

		<script src="http://maps.googleapis.com/maps/api/js?v=3.exp"></script>

		<script type="text/javascript" src="http://platform.linkedin.com/in.js">
api_key: 752f7e023f5cet
Secret_Key:8hEIlinuKm6NElKu
OAuth_User_Token:d85dac7f-2152-464c-a4cd-fce0090c2643
OAuth_User_Secret:7af07505-1776-4b78-8f63-c8cdd8ddb54b
authorize: true
credentials_cookie: true
credentials_cookie_crc: true
onLoad: onLinkedInLoad
scope: w_messages rw_company_admin r_emailaddress r_network r_basicprofile rw_groups r_fullprofile rw_nus r_contactinfo
		</script>

		<script type="text/javascript" src="js/country_names.js"></script>
		<script type="text/javascript" src="js/linkedin_utils.js"></script>
		<script type="text/javascript" src="js/geochart.js"></script>

		<!-- Google Map intialization-->
		<script>
			google.load('visualization', '1', {
				'packages' : ['geochart']
			});

			var chart;

			var width, height, selectedRegion, resolution;

			var global_provinceOptions, global_provinceData;
			var global_data, global_options;

			function refreshGeoChart() {
				chart.draw(global_data, global_options);
			}

			// google.setOnLoadCallback(drawMap);

			// Note: This example requires that you consent to location sharing when
			// prompted by your browser. If you see a blank space instead of the map, this
			// is probably because you have denied permission for location sharing.

			var map;

			var mFinalData = [];
			var m_country_name_arr = [];

			/**
			 * Map initialisation for country wise markers
			 * @author VSPLC
			 *
			 * @param {Object} connections
			 * @param {Object} total_countrywise_connections
			 * @param {Object} country_name_arr => array of country codes
			 */
			function initialize(connections, total_countrywise_connections, country_name_arr) {

				mFinalData = total_countrywise_connections;
				m_country_name_arr = country_name_arr;

				// var position = getLocationCoordinate("Delhi,India");
				// console.log("Position : " + position.lat + " " + position.lng);

				var mapOptions = {
					scaleControl : true,
					// Pune - 18.5203, 73.8567
					// India - 20.593684, 78.96288
					center : new google.maps.LatLng(20.593684, 78.96288),
					zoom : 2
				};

				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

				// getCitywiseConnctions("Delhi", mFinalData["in"]);
				// console.log("total_countrywise_connections : " + total_countrywise_connections.length);

				var locations = [];

				/*var total_cities = [];
				total_cities = getCitiesName(connections, country_name_arr);
				console.log("City Length : " + total_cities.length);

				for (var i=0; i < total_cities.length; i++) {
				var cities = total_cities["in"];
				for (var j=0; j < cities.length; j++) {
				console.log("City Name : " + cities[j]);
				}
				};*/

				// we currently fixed it to 10 countries instead of "total_countrywise_connections"
				for (var i = 0; i < total_countrywise_connections.length; i++) {

					var mCountryName = m_country_name_arr[i].toUpperCase();
					var mFullCountryName = getCountryName(mCountryName);

					var address = mFullCountryName;

					var position = getLocationCoordinate(address);

					if (position != null) {
						var location = {
							location_name : m_country_name_arr[i],
							latitude : position.lat,
							longitude : position.lng,
						};
						locations.push(location);
					} else {
						console.log("Geocode failed");
					};

				}

				setMarkers(map, locations, m_country_name_arr, mFinalData, connections);
			}

			/**
			 * Map initialisation for city wise marker
			 * @author VSPLC
			 *
			 * @param {Object} connections
			 * @param {Object} total_countrywise_connections
			 * @param {Object} country_name_arr => array of country codes
			 */
			function initializeForCities(connections, total_countrywise_connections, country_name_arr) {

				mFinalData = total_countrywise_connections;
				m_country_name_arr = country_name_arr;

				var mapOptions = {
					scaleControl : true,
					// Pune - 18.5203, 73.8567
					// India - 20.593684, 78.96288
					center : new google.maps.LatLng(20.593684, 78.96288),
					zoom : 2
				};

				map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

				for (var i = 0; i < country_name_arr.length; i++) {
					// console.log("Country Name : "+country_name_arr[i]);
					getOnItemOnclick(connections, mFinalData, country_name_arr[i]);
				};

			}

			/**
			 * Method used for plotting the country wise markers of linkedin users.
			 * @author VSPLC
			 *
			 * @param {Object} map
			 * @param {Object} locations => custom location objects with properties of lat-lang, title etc
			 * @param {Object} m_country_name_arr => array of country codes
			 * @param {Object} mFinalData => Total Country Wise Connections
			 * @param {Object} connections
			 */
			function setMarkers(map, locations, m_country_name_arr, mFinalData, connections) {

				var marker, i;
				for ( i = 0; i < locations.length; i++) {

					var location = locations[i];

					var loc_name = location.location_name;
					var lat = location.latitude;
					var lng = location.longitude;

					// lat-lang object..
					latlngset = new google.maps.LatLng(lat, lng);

					var marker = new google.maps.Marker({
						map : map,
						title : loc_name,
						position : latlngset
					});

					// map.setCenter(marker.getPosition())

					var mTempUsersArray_CountryWise = mFinalData[m_country_name_arr[i]];

					var mCountryName = m_country_name_arr[i].toUpperCase();
					var mFullCountryName = getCountryName(mCountryName);

					var content = '<div id="test_' + m_country_name_arr[i] + '"><b> ' + mFullCountryName + ' = ' + mTempUsersArray_CountryWise.length + '</b></div>';
					var infowindow = new google.maps.InfoWindow();

					google.maps.event.addListener(marker, 'click', (function(marker, content, infowindow) {
						return function() {
							infowindow.setContent(content);
							infowindow.open(map, marker);
						};
					})(marker, content, infowindow));

					google.maps.event.addDomListener(infowindow, 'domready', (function(marker) {

						return function() {
							var id = marker.title;
							// console.log("infoWindow : "+marker.title);
							getOnItemOnclick(connections, mFinalData, marker.title);
						};

					})(marker));
				}
			}

		</script>
		<!-- End of Google Map intialization-->

		<!-- Linkedin Stuff -->
		<script type="text/javascript">
			var global_connections = null;
			var global_total_countrywise_connections = null;
			var global_country_name_arr = null;

			function onLinkedInLoad() {
				IN.Event.on(IN, "auth", onLinkedInAuth);
				var div = document.getElementByClass("showorhide");
				div.style.visibility = "visible";
			}

			function onLinkedInAuth() {
				// IN.API.Profile("me").result(ShowProfileData);
				IN.API.Profile("me").fields("firstName", "lastName", "industry", "location:(name)", "picture-url", "headline", "summary", "num-connections", "public-profile-url", "distance", "positions", "email-address", "educations", "date-of-birth", "threeCurrentPositions").result(displayProfiles).error(displayProfilesErrors);
			}

			// Display user's profile information
			function displayProfiles(profiles) {
				document.getElementById('div1').style.display = 'block';
				member = profiles.values[0];

				document.getElementById("lblName").innerHTML = member.firstName + " " + member.lastName + "<br/> Location is " + member.location.name;
				document.getElementById("imgProfile").src = member.pictureUrl;
				document.getElementById("lblEmail").innerHTML = member.emailAddress;
				document.getElementById("lblProfile").innerHTML = member.publicProfileUrl;
				// document.getElementById("lblconnection").innerHTML = member.numConnections;
				// foo = member.numConnections;
			}

			function onLinkedInLogout() {
				//setConnections({}, {total:0});
				try {
					IN.User.logout();
				} catch (err) {
					console.log(err);
				}
				setTimeout("goToHome()", 10000);
			}

			function goToHome() {
				location.href = "index.html";
			}

			function onLinkedInconnection() {
				// here, we pass the fields as individual string parameters
				IN.API.Connections("me").fields("id", "firstName", "lastName", "pictureUrl", "publicProfileUrl", "threeCurrentPositions", "location:(name,country:(code))")
				//.params({"count" : foo})
				.result(function(result, metadata) {
					// var data = JSON.parse(JSON.stringify(result));
					// console.log(JSON.stringify(result));

					// console.log("Connection Results : "+data);
					setConnections(result.values, metadata);
				});

			}

		</script>
		<!-- End of Linkedin Stuff -->

		<title>VSPLC Linkedin Prototype</title>
	</head>
	<body>
		<p>
			This example demonstrates how to retrieve a user's connections.  It also uses the LinkedIn auth events (load, login,
			<input type="button" name="search1" value="Logout" onclick="onLinkedInLogout()">
			) to control behavior.
		</p>

		<script type="text/javascript">
			var assert = require('assert'), countrynames = require('./');

			assert.equal(countrynames.getCode('French Guiana'), 'GF');
			assert.equal(countrynames.getName('BF'), 'BURKINA FASO');
			assert.equal(countrynames.getCode('Iran'), countrynames.getCode('IRAN, ISLAMIC REPUBLIC OF'));
			assert.equal(countrynames.getCode(countrynames.getName('IO')), 'IO');
			assert.ok(countrynames.getAllCodes() instanceof Array);
			assert.ok(countrynames.getAllNames() instanceof Array);

			console.log('Passed successfully.');
		</script>

		<script type="IN/Login"></script>
		<input type="button" name="con" value="Connection" onclick="onLinkedInconnection()">

		<div id="div1" style="display:none">
			<table>
				<b>Get Linkedin LoggedIn User Details</b>
				<tr>
					<td>Name:</td>
					<td><label id="lblName"></label></td>
				</tr>
				<tr>
					<td>Email:</td>
					<td><label id="lblEmail"></label></td>
				</tr>
				<tr>
					<td>Profile Url:</td>
					<td><label id="lblProfile"></label></td>
				</tr>
				<tr>
					<td>Profile Image:</td>
					<td><img id="imgProfile"></label></td>
				</tr>
				<tr>
					<td>Connection:</td>
					<td><label id="lblconnection"></label></td>
				</tr>
			</table>
		</div>

		<div id="connectionsDiv">
			<p>
				Current User's Connections:
			</p>
			<div id="connectionsdata"></div>
			<div id="connections"></div>
		</div>

		<div id="radioBtns">
			<p>
				Filtering :
			</p>
			<input type="radio" id="rd_country" name="radio" checked="true" onclick="setCountryMarkers()"/>
			Conutry
			<input type="radio" id="rd_cities" name="radio" onclick="setCityMarkers()"/>
			City
		</div>

		<div id="map-canvas"></div>

		<input type="button" name="refresh" value="Back" onclick="refreshGeoChart()">

		<div id="chart_div"></div>
	</body>
</html>